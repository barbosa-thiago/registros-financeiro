<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
<head>
    <title>Sistema de cadastro de compra e pagamento</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <script
            src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>

    <link th:href="@{/styles/style.css}" rel="stylesheet"/>
    <link th:href="@{/styles/navbar.css}" rel="stylesheet"/>

</head>
<body>
<div th:replace="fragments/navbar :: header"></div>

<div class="result">

    <div class="d-flex justify-content-between">

        <div th:replace="fragments/selectmes :: div"></div>

        <a class="novo-registro btn btn-light my-4 p-3" href="/agendamentos">Novo agendamento</a>

    </div>


    <ul class="container">
        <li th:each="entry: ${somaMap}">
            <div class="d-flex justify-content-between border-top">

                <h3 class="d-inline"
                    th:text="${#temporals.format(entry.value.dataTotalPagamentos.data, 'dd/MMM')}"></h3>
                <p class="font-weight-bold" th:text="'Total: ' + ${entry.value.dataTotalPagamentos.somaDoDia}"></p>
            </div>
            <ul class="row card-container">

                <li class="card card-agendamento m-1  mb-4 text-center"
                    th:classappend="${value.pago} ? 'foi-pago' : 'nao-foi-pago'"
                    th:each="value: ${entry.value.agendamentos}">
                    <div class="my-auto"
                            th:if="value">
                        <span th:text="${value.fornecedor}"></span><br/>
                        <span th:text="${value.valor}"></span><br/>

                        <form class="d-inline agendamento-pg"
                              th:action="@{/agendamentos/update/{id}(id=${value.id})}"
                              method="post">
                            <input type="hidden" name="pago" th:value="${!value.pago}"/>
                        </form>
                    </div>
                </li>
                <li class="card card-ad  m-1 mb-4 text-center"
                    data-bs-toggle="modal"
                    data-bs-target="#meumodal"
                    onclick="openModal(this)"
                    th:attr="data-agendamento-date=${entry.value.dataTotalPagamentos.data}">
                    <p class="my-auto">Agendar pagamento</p>
                </li>
            </ul>
        </li>
    </ul>

</div>

<div th:insert="fragments/agendamentomodal :: div"></div>

<script th:inline="javascript">
    function openModal(li) {
        let date = li.getAttribute('data-agendamento-date');

        let dateParts = date.split('-');
        let year = parseInt(dateParts[0]);
        let month = parseInt(dateParts[1]) - 1;
        let day = parseInt(dateParts[2]);

        document.getElementById('data-ag-modal').value = Intl.DateTimeFormat("fr-FR", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
        }).format(new Date(year, month, day));;
    }

    document.addEventListener("DOMContentLoaded", function () {
        let clickableDivs = document.querySelectorAll(".card-agendamento");

        clickableDivs.forEach(div => {
            div.addEventListener("click", () =>{
                div.getElementsByClassName("agendamento-pg")[0].submit();
                div.style.backgroundColor= "lightgray";
            });
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



</body>
</html>